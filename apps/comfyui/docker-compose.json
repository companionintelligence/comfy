{
    "$schema": "https://schemas.runtipi.io/v2/dynamic-compose.json",
    "schemaVersion": 2,
    "services": [
      {
        "name": "comfyui",
        "image": "comfyanonymous/comfyui:latest",
        "isMain": true,
        "internalPort": 8188,
        "environment": [
          {
            "key": "COMFYUI_EXTRA_MODEL_PATHS",
            "value": "${COMFYUI_EXTRA_MODEL_PATHS}"
          },
          {
            "key": "COMFYUI_ENABLE_GPU",
            "value": "${COMFYUI_ENABLE_GPU}"
          },
          {
            "key": "OLLAMA_MODELS_PATH",
            "value": "${OLLAMA_MODELS_PATH}"
          }
        ],
        "volumes": [
          {
            "hostPath": "${APP_DATA_DIR}/models",
            "containerPath": "/app/models"
          },
          {
            "hostPath": "${APP_DATA_DIR}/output",
            "containerPath": "/app/output"
          },
          {
            "hostPath": "${APP_DATA_DIR}/input",
            "containerPath": "/app/input"
          },
          {
            "hostPath": "${OLLAMA_MODELS_PATH}",
            "containerPath": "/app/ollama-models"
          }
        ],
        "addPorts": [
          {
            "containerPort": 8188,
            "hostPort": "${APP_PORT}"
          }
        ],
        "deploy": {
          "resources": {
            "reservations": {
              "devices": [
                {
                  "capabilities": ["gpu"],
                  "driver": "nvidia"
                }
              ]
            }
          }
        }
      }
    ]
  }
  
  